<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code Demo - Barns</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    .demo-container {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }
    
    .demo-header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }
    
    .demo-title {
      font-size: 32px;
      font-weight: 700;
      margin: 0 0 16px;
    }
    
    .demo-subtitle {
      font-size: 18px;
      opacity: 0.9;
      margin: 0;
    }
    
    .demo-content {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    .demo-section {
      margin-bottom: 40px;
    }
    
    .demo-section-title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
      margin: 0 0 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .demo-section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      border-radius: 2px;
    }
    
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .demo-card {
      background: #f8f9fa;
      border-radius: 16px;
      padding: 24px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .demo-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.1);
      border-color: #4CAF50;
    }
    
    .demo-card-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin: 0 0 12px;
    }
    
    .demo-card-description {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
      margin: 0 0 16px;
    }
    
    .demo-card-data {
      background: white;
      border-radius: 8px;
      padding: 12px;
      font-family: monospace;
      font-size: 12px;
      color: #333;
      word-break: break-all;
      border: 1px solid #e9ecef;
    }
    
    .demo-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .demo-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .demo-btn.primary {
      background: linear-gradient(135deg, #4CAF50, #8BC34A);
      color: white;
    }
    
    .demo-btn.secondary {
      background: #f8f9fa;
      color: #666;
      border: 2px solid #e9ecef;
    }
    
    .demo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .demo-info {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border: 2px solid #2196f3;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .demo-info-title {
      font-size: 18px;
      font-weight: 700;
      color: #1976d2;
      margin: 0 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .demo-info-text {
      font-size: 14px;
      color: #1976d2;
      line-height: 1.6;
      margin: 0;
    }
    
    .demo-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    
    .demo-stat {
      background: white;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 2px solid #e9ecef;
    }
    
    .demo-stat-number {
      font-size: 24px;
      font-weight: 700;
      color: #4CAF50;
      margin: 0 0 8px;
    }
    
    .demo-stat-label {
      font-size: 14px;
      color: #666;
      margin: 0;
    }
    
    .clear-btn {
      background: linear-gradient(135deg, #f44336, #e91e63);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .clear-btn:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body data-page="qr-demo">
  <div class="demo-container">
    <div class="demo-header">
      <h1 class="demo-title">QR Code System Demo</h1>
      <p class="demo-subtitle">Test the invoice scanning and duplicate detection system</p>
    </div>
    
    <div class="demo-content">
      <div class="demo-info">
        <div class="demo-info-title">
          ℹ️ How It Works
        </div>
        <div class="demo-info-text">
          This demo shows how the QR code system prevents duplicate scans. Each QR code can only be scanned once. 
          Try scanning the same code multiple times to see the duplicate detection in action.
        </div>
      </div>
      
      <div class="demo-section">
        <h2 class="demo-section-title">Test QR Codes</h2>
        <p style="color: #666; margin-bottom: 20px;">
          Use your phone's camera or QR scanner app to scan these test codes. Each can only be scanned once per session.
        </p>
        
        <div class="demo-grid">
          <div class="demo-card" onclick="simulateScan('INV-001-2024')">
            <div class="demo-card-title">Invoice #001</div>
            <div class="demo-card-description">Test invoice with unique identifier</div>
            <div class="demo-card-data">INV-001-2024</div>
          </div>
          
          <div class="demo-card" onclick="simulateScan('INV-002-2024')">
            <div class="demo-card-title">Invoice #002</div>
            <div class="demo-card-description">Another test invoice</div>
            <div class="demo-card-data">INV-002-2024</div>
          </div>
          
          <div class="demo-card" onclick="simulateScan('INV-003-2024')">
            <div class="demo-card-title">Invoice #003</div>
            <div class="demo-card-description">Third test invoice</div>
            <div class="demo-card-data">INV-003-2024</div>
          </div>
          
          <div class="demo-card" onclick="simulateScan('CUSTOM-12345')">
            <div class="demo-card-title">Custom Code</div>
            <div class="demo-card-description">Custom invoice code</div>
            <div class="demo-card-data">CUSTOM-12345</div>
          </div>
        </div>
      </div>
      
      <div class="demo-section">
        <h2 class="demo-section-title">System Statistics</h2>
        <div class="demo-stats">
          <div class="demo-stat">
            <div class="demo-stat-number" id="total-scanned">0</div>
            <div class="demo-stat-label">Total Scanned</div>
          </div>
          <div class="demo-stat">
            <div class="demo-stat-number" id="unique-codes">0</div>
            <div class="demo-stat-label">Unique Codes</div>
          </div>
          <div class="demo-stat">
            <div class="demo-stat-number" id="duplicate-attempts">0</div>
            <div class="demo-stat-label">Duplicate Attempts</div>
          </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
          <button class="clear-btn" onclick="clearAllData()">Clear All Data</button>
        </div>
      </div>
      
      <div class="demo-actions">
        <a href="qr.html" class="demo-btn primary">Open QR Scanner</a>
        <a href="tree.html" class="demo-btn secondary">Go to Tree</a>
        <a href="index.html" class="demo-btn secondary">Go Home</a>
      </div>
    </div>
  </div>

  <script>
    // Load scanned QR codes from localStorage
    function loadScannedQrCodes() {
      try {
        const raw = localStorage.getItem('barns-scanned-qr-codes');
        const parsed = raw ? JSON.parse(raw) : null;
        if (parsed && typeof parsed === 'object') return parsed;
      } catch {}
      return {};
    }
    
    // Simulate scanning a QR code
    function simulateScan(qrData) {
      const codes = loadScannedQrCodes();
      
      if (codes.hasOwnProperty(qrData)) {
        // Already scanned - show duplicate message
        const scanInfo = codes[qrData];
        const timestamp = scanInfo ? scanInfo.timestamp : Date.now();
        
        // Update duplicate attempts counter
        const duplicateCount = parseInt(localStorage.getItem('barns-demo-duplicate-count') || '0') + 1;
        localStorage.setItem('barns-demo-duplicate-count', duplicateCount.toString());
        
        // Show duplicate result - redirect to tree page
        alert('This invoice has already been scanned!');
        window.open('tree.html', '_blank', 'noopener');
      } else {
        // New scan - save and show success
        const timestamp = Date.now();
        codes[qrData] = {
          timestamp: timestamp,
          user: 'Demo User'
        };
        localStorage.setItem('barns-scanned-qr-codes', JSON.stringify(codes));
        
        // Show success result - redirect to rate page
        window.open('rate.html', '_blank', 'noopener');
      }
      
      // Update stats
      updateStats();
    }
    
    // Update statistics display
    function updateStats() {
      const codes = loadScannedQrCodes();
      const totalScanned = Object.keys(codes).length;
      const duplicateCount = parseInt(localStorage.getItem('barns-demo-duplicate-count') || '0');
      
      document.getElementById('total-scanned').textContent = totalScanned;
      document.getElementById('unique-codes').textContent = totalScanned;
      document.getElementById('duplicate-attempts').textContent = duplicateCount;
    }
    
    // Clear all demo data
    function clearAllData() {
      if (confirm('Are you sure you want to clear all demo data? This will reset all scanned QR codes.')) {
        localStorage.removeItem('barns-scanned-qr-codes');
        localStorage.removeItem('barns-demo-duplicate-count');
        updateStats();
        alert('All demo data has been cleared!');
      }
    }
    
    // Initialize stats on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateStats();
    });
  </script>
</body>
</html>
